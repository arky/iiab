---
language: python
python: "2.7"

# Use the new container infrastructure
sudo: false

# Install ansible
addons:
  apt:
    packages:
    - python-pip

install:
  # Install ansible, ansible-lint and ansible-review
  - pip install ansible
  - pip install ansible-review

  # Check ansible,  version
  - ansible --version
  - ansible-lint --version
  - ansible-review --version

  # Create ansible.cfg with correct roles_path
  - printf '[defaults]\nroles_path=../' >ansible.cfg

script:
  # Continuous integration: syntax check
  - ansible-playbook tests/test.yml -i tests/inventory --syntax-check -vvv

  # Continous integration: ansible-list
  - ansible-lint -p *yml

  #  Continous integration: run select ansible code reviews
  - git ls-files *yml roles/ vars/ tests/  | xargs ansible-review -s "Roles file should be in yaml format" -s "Inventory must be parseable" -s "Inventory host files should not" -s "Tasks and handlers must be uniquely named within a single file" -s "Tasks and handlers must be uniquely named within a single file" -s "Vars should only occur once per file" -s "Use YAML format for tasks and handlers rather than key=value" -s "Files should contain useful content" -s "Host vars should not be present" -s "Same variable defined in siblings"

#notifications:
#   webhooks: https://galaxy.ansible.com/api/v1/notifications/
#
#  irc:
#    channels: "irc.freenode.org#fabric"
#    template:
#      - "%{repository}@%{branch}: %{message} (%{build_url})"
#    on_success: change
#    on_failure: change
#  email: false
