---
- hosts: localhost
  connection: local
  become: true
  remote_user: root
  gather_facts: true
  pre_tasks:
    - name: "Create /etc/iiab directory"
      file:
        path: "/etc/iiab"
        state: "directory"

    - name: "Create custom fact directory"
      file:
        path: "/etc/ansible/facts.d"
        state: "directory"
    - name: "Copy Medium.localvars"
      copy:
        src: ../vars/medium.localvars
        dest: ../vars/local_vars.yml
        mode: 0755
    - name: "Insert custom fact file"
      copy:
        src: ../scripts/local_facts.fact
        dest: /etc/ansible/facts.d/local_facts.fact
        mode: 0755

  vars_files:
  - ../vars/default_vars.yml
  - ../vars/medium.localvars
  - ../vars/ubuntu-16.yml
  #- ../vars/{{ ansible_local.local_facts.os_ver }}.yml
  #- ../vars/local_vars.yml


  # TODO: Making a anisble-iiab roles for ansible-galaxy
  #  roles:
  #      - iiab
  # For now hardcoding all the roles manually with  ls -l roles/ | cut -d " " -f 10
  roles:
    - {role: ../roles/1-prep}
    - {role: ../roles/2-common}
    - {role: ../roles/3-base-server}
    - {role: ../roles/4-server-options}
    - {role: ../roles/5-xo-services}
    - {role: ../roles/6-generic-apps}
    - {role: ../roles/7-edu-apps}
    - {role: ../roles/8-mgmt-tools}
    - {role: ../roles/9-local-addons}
    - {role: ../roles/activity-server}
    - {role: ../roles/ajenti}
    - {role: ../roles/authserver}
    - {role: ../roles/awstats}
    - {role: ../roles/calibre}
    - {role: ../roles/cups}
    - {role: ../roles/debian_schooltool}
    - {role: ../roles/docker}
    - {role: ../roles/dokuwiki}
    - {role: ../roles/ejabberd}
    - {role: ../roles/ejabberd_xs}
    - {role: ../roles/elgg}
    - {role: ../roles/httpd}
    - {role: ../roles/idmgr}
    - {role: ../roles/iiab-admin}
    - {role: ../roles/kalite}
    - {role: ../roles/kiwix}
    - {role: ../roles/mongodb}
    - {role: ../roles/monit}
    - {role: ../roles/moodle}
    - {role: ../roles/moodle-1.9}
    - {role: ../roles/munin}
    - {role: ../roles/mysql}
    - {role: ../roles/network}
    - {role: ../roles/nextcloud}
    - {role: ../roles/openvpn}
    - {role: ../roles/osm}
    - {role: ../roles/owncloud}
    - {role: ../roles/pathagar}
    - {role: ../roles/phpmyadmin}
    - {role: ../roles/postgresql}
    - {role: ../roles/rachel}
    - {role: ../roles/samba}
    - {role: ../roles/schooltool}
    - {role: ../roles/sshd}
    - {role: ../roles/sugarizer}
    - {role: ../roles/sugar-stats}
    - {role: ../roles/teamviewer}
    - {role: ../roles/usb-lib}
    - {role: ../roles/vnstat}
    - {role: ../roles/wordpress}
    - {role: ../roles/xovis}
